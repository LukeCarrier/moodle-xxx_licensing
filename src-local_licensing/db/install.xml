<?xml version="1.0" encoding="utf-8" ?>
<XMLDB PATH="enrol/licensing/db" VERSION="20141210" 
       COMMENT="XMLDB file for Moodle enrol/licensing"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="../../../lib/xmldb/xmldb.xsd">
    <!--
      * Moodle licensing enrolment plugin.
      *
      * @author Luke Carrier <luke@carrier.im>
      * @author Luke Carrier <luke@tdm.co>
      * @copyright 2014 Luke Carrier, The Development Manager Ltd
      -->
    <TABLES>
        <TABLE NAME="lic_allocation" COMMENT="Licence allocations">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="true" />
                <FIELD NAME="count" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="false" />
                <FIELD NAME="productsetid" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="false" />
                <FIELD NAME="targetid" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="false" />
                <FIELD NAME="startdate" TYPE="int" LENGTH="10"
                       NOTNULL="false" SEQUENCE="true" />
                <FIELD NAME="enddate" TYPE="int" LENGTH="10"
                       NOTNULL="false" SEQUENCE="true" />
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id" />
                <KEY NAME="fk_productsetid" TYPE="foreign" FIELDS="productsetid"
                     REFTABLE="lic_productset" REFFIELDS="id" />
                <KEY NAME="fk_targetid" TYPE="foreign" FIELDS="targetid"
                     REFTABLE="lic_target" REFFIELDS="id" />
            </KEYS>
        </TABLE>

        <TABLE NAME="lic_licence" COMMENT="Distributed licences">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="true" />
                <FIELD NAME="productid" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="false" />
                <FIELD NAME="userid" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="false" />
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id" />
                <KEY NAME="fk_productid" TYPE="foreign" FIELDS="productid"
                     REFTABLE="lic_product" REFFIELDS="id" />
                <KEY NAME="fk_userid" TYPE="foreign" FIELDS="userid"
                     REFTABLE="user" REFFIELDS="id" />
            </KEYS>
        </TABLE>

        <TABLE NAME="lic_product"
               COMMENT="Products which can be allocated/distributed">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="true" />
                <FIELD NAME="itemid" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="false" />
                <FIELD NAME="productsetid" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="false" />
                <FIELD NAME="type" TYPE="char" LENGTH="255"
                       NOTNULL="true" />
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id" />
                <KEY NAME="fk_productsetid" TYPE="foreign" FIELDS="productsetid"
                     REFTABLE="lic_productset" REFFIELDS="id" />
            </KEYS>
        </TABLE>

        <TABLE NAME="lic_productset"
               COMMENT="Collections of products which can be allocated/distributed">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="true" />
                <FIELD NAME="name" TYPE="char" LENGTH="255"
                       NOTNULL="true" />
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id" />
            </KEYS>
        </TABLE>

        <TABLE NAME="lic_target" COMMENT="Targets licenses may be allocated to">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="true" />
                <FIELD NAME="itemid" TYPE="int" LENGTH="10"
                       NOTNULL="true" SEQUENCE="false" />
                <FIELD NAME="type" TYPE="char" LENGTH="255"
                       NOTNULL="true" />
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id" />
            </KEYS>
        </TABLE>
    </TABLES>
</XMLDB>
